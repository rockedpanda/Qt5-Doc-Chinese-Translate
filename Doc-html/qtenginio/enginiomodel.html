<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- enginiomodel.cpp -->
  <title>EnginioModel Class | QtEnginio 1.0</title>
  <link rel="stylesheet" type="text/css" href="style/offline.css" />
</head>
<body>
<div class="header" id="qtdocheader">
    <div class="main">
    <div class="main-rounded">
        <div class="navigationbar">
        <ul>
<li><a href="../qtenginiooverview/enginio-index.html">Enginio Manual</a></li>
<li><a href="enginio-cpp-classes-and-examples.html">Enginio C++ Classes and Examples</a></li>
<li>EnginioModel</li>
<li id="buildversion">
Enginio 1.0.5 Reference Documentation</li>
    </ul>
    </div>
</div>
<div class="content">
<div class="line">
<div class="content mainContent">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#properties">Properties</a></li>
<li class="level1"><a href="#public-functions">Public Functions</a></li>
<li class="level1"><a href="#signals">Signals</a></li>
<li class="level1"><a href="#details">Detailed Description</a></li>
</ul>
</div>
<h1 class="title">EnginioModel Class</h1>
<!-- $$$EnginioModel-brief -->
<p>EnginioModel represents data from Enginio as a <a href="../qtcore/qabstractlistmodel.html">QAbstractListModel</a>. <a href="#details">More...</a></p>
<!-- @@@EnginioModel -->
<table class="alignedsummary">
<tr><td class="memItemLeft rightAlign topAlign"> Header:</td><td class="memItemRight bottomAlign"> </b><tt><span class="preprocessor">#include &lt;EnginioModel&gt;</span>
</tt></td></tr><tr><td class="memItemLeft rightAlign topAlign"> Since:</td><td class="memItemRight bottomAlign">  Qt 5.3</td></tr><tr><td class="memItemLeft rightAlign topAlign"> Inherits:</td><td class="memItemRight bottomAlign"> <a href="../qtcore/qabstractlistmodel.html">QAbstractListModel</a>.</td></tr></table><ul>
<li><a href="enginiomodel-members.html">List of all members, including inherited members</a></li>
</ul>
<a name="properties"></a>
<h2>Properties</h2>
<ul>
<li class="fn"><b><a href="enginiomodel.html#client-prop">client</a></b> : EnginioClient *</li>
<li class="fn"><b><a href="enginiomodel.html#operation-prop">operation</a></b> : Enginio::Operation</li>
<li class="fn"><b><a href="enginiomodel.html#query-prop">query</a></b> : QJsonObject</li>
</ul>
<ul>
<li class="fn">1 property inherited from <a href="../qtcore/qobject.html#properties">QObject</a></li>
</ul>
<a name="public-functions"></a>
<h2>Public Functions</h2>
<table class="alignedsummary">
<tr><td class="memItemLeft rightAlign topAlign"> </td><td class="memItemRight bottomAlign"><b><a href="enginiomodel.html#EnginioModel">EnginioModel</a></b>(QObject *<i> parent</i> = 0)</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> </td><td class="memItemRight bottomAlign"><b><a href="enginiomodel.html#dtor.EnginioModel">~EnginioModel</a></b>()</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> EnginioReply * </td><td class="memItemRight bottomAlign"><b><a href="enginiomodel.html#append">append</a></b>(const QJsonObject &amp;<i> object</i>)</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> EnginioClient * </td><td class="memItemRight bottomAlign"><b><a href="enginiomodel.html#client-prop">client</a></b>() const</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> Enginio::Operation </td><td class="memItemRight bottomAlign"><b><a href="enginiomodel.html#operation-prop">operation</a></b>() const</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> QJsonObject </td><td class="memItemRight bottomAlign"><b><a href="enginiomodel.html#query-prop">query</a></b>()</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> EnginioReply * </td><td class="memItemRight bottomAlign"><b><a href="enginiomodel.html#remove">remove</a></b>(int<i> row</i>)</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> void </td><td class="memItemRight bottomAlign"><b><a href="enginiomodel.html#client-prop">setClient</a></b>(const EnginioClient *<i> client</i>)</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> EnginioReply * </td><td class="memItemRight bottomAlign"><b><a href="enginiomodel.html#setData">setData</a></b>(int<i> row</i>, const QVariant &amp;<i> value</i>, const QString &amp;<i> role</i>)</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> void </td><td class="memItemRight bottomAlign"><b><a href="enginiomodel.html#operation-prop">setOperation</a></b>(Enginio::Operation<i> operation</i>)</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> void </td><td class="memItemRight bottomAlign"><b><a href="enginiomodel.html#query-prop">setQuery</a></b>(const QJsonObject &amp;<i> query</i>)</td></tr>
</table>
<ul>
<li class="fn">3 public functions inherited from <a href="../qtcore/qabstractlistmodel.html#public-functions">QAbstractListModel</a></li>
<li class="fn">39 public functions inherited from <a href="../qtcore/qabstractitemmodel.html#public-functions">QAbstractItemModel</a></li>
<li class="fn">31 public functions inherited from <a href="../qtcore/qobject.html#public-functions">QObject</a></li>
</ul>
<a name="signals"></a>
<h2>Signals</h2>
<table class="alignedsummary">
<tr><td class="memItemLeft rightAlign topAlign"> void </td><td class="memItemRight bottomAlign"><b><a href="enginiomodel.html#client-prop">clientChanged</a></b>(EnginioClient *<i> client</i>)</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> void </td><td class="memItemRight bottomAlign"><b><a href="enginiomodel.html#operation-prop">operationChanged</a></b>(Enginio::Operation<i> operation</i>)</td></tr>
<tr><td class="memItemLeft rightAlign topAlign"> void </td><td class="memItemRight bottomAlign"><b><a href="enginiomodel.html#query-prop">queryChanged</a></b>(const QJsonObject &amp;<i> query</i>)</td></tr>
</table>
<ul>
<li class="fn">18 signals inherited from <a href="../qtcore/qabstractitemmodel.html#signals">QAbstractItemModel</a></li>
<li class="fn">2 signals inherited from <a href="../qtcore/qobject.html#signals">QObject</a></li>
</ul>
<h3>Additional Inherited Members</h3>
<ul>
<li class="fn">2 public slots inherited from <a href="../qtcore/qabstractitemmodel.html#public-slots">QAbstractItemModel</a></li>
<li class="fn">1 public slot inherited from <a href="../qtcore/qobject.html#public-slots">QObject</a></li>
<li class="fn">1 public variable inherited from <a href="../qtcore/qobject.html#public-variables">QObject</a></li>
<li class="fn">10 static public members inherited from <a href="../qtcore/qobject.html#static-public-members">QObject</a></li>
<li class="fn">19 protected functions inherited from <a href="../qtcore/qabstractitemmodel.html#protected-functions">QAbstractItemModel</a></li>
<li class="fn">9 protected functions inherited from <a href="../qtcore/qobject.html#protected-functions">QObject</a></li>
<li class="fn">1 protected slot inherited from <a href="../qtcore/qabstractitemmodel.html#protected-slots">QAbstractItemModel</a></li>
<li class="fn">2 protected variables inherited from <a href="../qtcore/qobject.html#protected-variables">QObject</a></li>
</ul>
<a name="details"></a>
<!-- $$$EnginioModel-description -->
<div class="descr">
<h2>Detailed Description</h2>
<a name="enginiomodelcpp"></a><p>EnginioModel represents data from Enginio as a <a href="../qtcore/qabstractlistmodel.html">QAbstractListModel</a>.</p>
<p>EnginioModel is a <a href="../qtcore/qabstractlistmodel.html">QAbstractListModel</a>, together with a view it allows to show the result of a query in a convenient way. The model executes query, update and create operations asynchronously on an Enginio backend collection, which allows not only to read data from the cloud but also modify it.</p>
<p>The simplest type of query is:</p>
<pre class="cpp">{ <span class="string">&quot;objectType&quot;</span>: <span class="string">&quot;objects.fruits&quot;</span> }</pre>
<p>Assigning such a query to the model results in downloading of all objects from the &quot;objects.fruits&quot; collection. It is possible to <a href="enginiomodel.html#append">append</a> new objects, to <a href="enginiomodel.html#setData">modify</a> or to <a href="enginiomodel.html#remove">remove</a> them.</p>
<p>The query has to result in a list of objects, each object becomes an item in the model. Properties of the items are used as role names. There are a few predefined role names that will always be available (<a href="enginio.html#Role-enum">Role</a>).</p>
<p>The operations are executed asynchronously, which means that user interface is not blocked while the model is initialized and updated. Every modification is divided in two steps; request and confirmation. For example when <a href="enginiomodel.html#append">append</a> is called EnginioModel returns immediately as if the operation had succeeded. In the background it waits for confirmation from the backend and only then the operation is really finished. It may happen that operation fails, for example because of insufficient access rights, in that case the operation will be reverted.</p>
<p>There are two, ways of tracking if an item state is the same in the model and backend. Each item has a role that returns a boolean <a href="enginio.html#Role-enum">SyncedRole</a>, role name &quot;_synced&quot; which indicates whether the item is successfully updated on the server. This role can for example meant to be used for a busy indicator while a property is being updated. Alternatively the status of each <a href="enginioreply.html">EnginioReply</a> returned by EnginioModel can be tracked. The operation is confirmed when the reply is <a href="enginioreply.html#isFinished">finished</a> without <a href="enginioreply.html#isError">error</a>.</p>
<p>When a reply is finished it is the user's responsibility to delete it, it can be done by connecting the <a href="enginioreply.html#finished">finished</a> signal to <a href="../qtcore/qobject.html#deleteLater">deleteLater</a>.</p>
<pre class="cpp"><span class="type"><a href="../qtcore/qobject.html">QObject</a></span><span class="operator">::</span><a href="../qtcore/qobject.html#connect">connect</a>(reply<span class="operator">,</span> <span class="operator">&amp;</span>EnginioReply<span class="operator">::</span>finished<span class="operator">,</span> reply<span class="operator">,</span> <span class="operator">&amp;</span>EnginioReply<span class="operator">::</span>deleteLater);</pre>
<p><b>Note: </b>it is not safe to use the delete operator directly in <a href="enginioreply.html#finished">finished</a>.</p><p><b>Note: </b><a href="enginioclient.html">EnginioClient</a> emits the finished and error signals for the model, not the model itself.</p><p>The <a href="enginiomodel.html#query-prop">query</a> can contain one or more options: The &quot;sort&quot; option, to get presorted data:</p>
<pre class="cpp">{
  <span class="string">&quot;objectType&quot;</span>: <span class="string">&quot;objects.fruits&quot;</span><span class="operator">,</span>
  <span class="string">&quot;sort&quot;</span>: <span class="operator">[</span>{<span class="string">&quot;sortBy&quot;</span>:<span class="string">&quot;price&quot;</span><span class="operator">,</span> <span class="string">&quot;direction&quot;</span>: <span class="string">&quot;asc&quot;</span>}<span class="operator">]</span>
}</pre>
<p>The &quot;query&quot; option is used for filtering:</p>
<pre class="cpp">{
  <span class="string">&quot;objectType&quot;</span>: <span class="string">&quot;objects.fruits&quot;</span><span class="operator">,</span>
  <span class="string">&quot;query&quot;</span>: {<span class="string">&quot;name&quot;</span>: {<span class="string">&quot;$in&quot;</span>: <span class="operator">[</span><span class="string">&quot;apple&quot;</span><span class="operator">,</span> <span class="string">&quot;orange&quot;</span><span class="operator">,</span> <span class="string">&quot;kiwi&quot;</span><span class="operator">]</span>}}
}</pre>
<p>The &quot;limit&quot; option to limit the amount of results:</p>
<pre class="cpp">{
  <span class="string">&quot;objectType&quot;</span>: <span class="string">&quot;objects.fruits&quot;</span><span class="operator">,</span>
  <span class="string">&quot;limit&quot;</span>: <span class="number">10</span>
}</pre>
<p>The &quot;offset&quot; option to skip some results from the beginning of a result set:</p>
<pre class="cpp">{
  <span class="string">&quot;objectType&quot;</span>: <span class="string">&quot;objects.fruits&quot;</span><span class="operator">,</span>
  <span class="string">&quot;offset&quot;</span>: <span class="number">10</span>
}</pre>
<p>The options are valid only during the initial model population and are not enforced in anyway when updating or otherwise modifying the model data. <a href="../qtcore/qsortfilterproxymodel.html">QSortFilterProxyModel</a> can be used to do more advanced sorting and filtering on the client side.</p>
<p>EnginioModel can not detect when a property of a result is computed by the backend. For example the &quot;include&quot; option to <a href="enginiomodel.html#query-prop">query</a> fills in the original creator of and object with the full object representing the &quot;creator&quot;.</p>
<pre class="cpp">{
  <span class="string">&quot;objectType&quot;</span>: <span class="string">&quot;objects.fruits&quot;</span><span class="operator">,</span>
  <span class="string">&quot;include&quot;</span>: {<span class="string">&quot;creator&quot;</span>: {}}
}</pre>
<p>For the model the &quot;creator&quot; property is not longer a reference (as it is on the backend), but a full object. But while the full object is accessible, attempts to alter the object's data will fail.</p>
</div>
<!-- @@@EnginioModel -->
<div class="prop">
<h2>Property Documentation</h2>
<!-- $$$client-prop$$$client$$$setClientconstEnginioClient*$$$clientChangedEnginioClient* -->
<h3 class="fn"><a name="client-prop"></a><span class="name">client</span> : <span class="type"><a href="enginioclient.html">EnginioClient</a></span> *</h3>
<p>This property holds the EnginioClient used by the model.</p>
<p><b>Access functions:</b></p>
<table class="alignedsummary">
<tr><td class="memItemLeft topAlign rightAlign"> EnginioClient * </td><td class="memItemRight bottomAlign"><span class="name"><b>client</b></span>() const</td></tr>
<tr><td class="memItemLeft topAlign rightAlign"> void </td><td class="memItemRight bottomAlign"><span class="name"><b>setClient</b></span>(const EnginioClient *<i> client</i>)</td></tr>
</table>
<p><b>Notifier signal:</b></p>
<table class="alignedsummary">
<tr><td class="memItemLeft topAlign rightAlign"> void </td><td class="memItemRight bottomAlign"><span class="name"><b>clientChanged</b></span>(EnginioClient *<i> client</i>)</td></tr>
</table>
<p><b>See also </b><a href="enginioclient.html">EnginioClient</a>.</p>
<!-- @@@client -->
<!-- $$$operation-prop$$$operation$$$setOperationEnginio::Operation$$$operationChangedEnginio::Operation -->
<h3 class="fn"><a name="operation-prop"></a><span class="name">operation</span> : <span class="type"><a href="enginio.html#Operation-enum">Enginio::Operation</a></span></h3>
<p>This property holds the operation type of the query.</p>
<p><b>Access functions:</b></p>
<table class="alignedsummary">
<tr><td class="memItemLeft topAlign rightAlign"> Enginio::Operation </td><td class="memItemRight bottomAlign"><span class="name"><b>operation</b></span>() const</td></tr>
<tr><td class="memItemLeft topAlign rightAlign"> void </td><td class="memItemRight bottomAlign"><span class="name"><b>setOperation</b></span>(Enginio::Operation<i> operation</i>)</td></tr>
</table>
<p><b>Notifier signal:</b></p>
<table class="alignedsummary">
<tr><td class="memItemLeft topAlign rightAlign"> void </td><td class="memItemRight bottomAlign"><span class="name"><b>operationChanged</b></span>(Enginio::Operation<i> operation</i>)</td></tr>
</table>
<p><b>See also </b><a href="enginio.html#Operation-enum">Enginio::Operation</a> and <a href="enginiomodel.html#query-prop">query</a>().</p>
<!-- @@@operation -->
<!-- $$$query-prop$$$query$$$setQueryconstQJsonObject&$$$queryChangedconstQJsonObject& -->
<h3 class="fn"><a name="query-prop"></a><span class="name">query</span> : <span class="type"><a href="../qtcore/qjsonobject.html">QJsonObject</a></span></h3>
<p>This property holds the query used to populate the model with data from the backend.</p>
<p>See <a href="enginioclient.html#query">EnginioClient::query</a>() documentation for information on how to construct a query.</p>
<p>While the <a href="enginioclient.html">EnginioClient</a> implementation of <tt>query()</tt> returns the data of a query as a JSON object, for the model the query will be interpreted as the model data.</p>
<p>Usually, the query is for a single object type and will return all objects in the database of that type. The model will then represent each returned object as one row. It can be limited and sorted just like its counterpart in <a href="enginioclient.html">EnginioClient</a>.</p>
<p>One important thing to note is that the model cannot keep the same sorting as the backend, and thus sorting and limits are only preserved until an insertion or deletion happens.</p>
<p><b>Access functions:</b></p>
<table class="alignedsummary">
<tr><td class="memItemLeft topAlign rightAlign"> QJsonObject </td><td class="memItemRight bottomAlign"><span class="name"><b>query</b></span>()</td></tr>
<tr><td class="memItemLeft topAlign rightAlign"> void </td><td class="memItemRight bottomAlign"><span class="name"><b>setQuery</b></span>(const QJsonObject &amp;<i> query</i>)</td></tr>
</table>
<p><b>Notifier signal:</b></p>
<table class="alignedsummary">
<tr><td class="memItemLeft topAlign rightAlign"> void </td><td class="memItemRight bottomAlign"><span class="name"><b>queryChanged</b></span>(const QJsonObject &amp;<i> query</i>)</td></tr>
</table>
<p><b>See also </b><a href="enginioclient.html#query">EnginioClient::query</a>().</p>
<!-- @@@query -->
</div>
<div class="func">
<h2>Member Function Documentation</h2>
<!-- $$$EnginioModel[overload1]$$$EnginioModelQObject* -->
<h3 class="fn"><a name="EnginioModel"></a>EnginioModel::<span class="name">EnginioModel</span>(<span class="type"><a href="../qtcore/qobject.html">QObject</a></span> *<i> parent</i> = 0)</h3>
<p>Constructs a new model with <i>parent</i> as <a href="../qtcore/qobject.html">QObject</a> parent.</p>
<!-- @@@EnginioModel -->
<!-- $$$~EnginioModel[overload1]$$$~EnginioModel -->
<h3 class="fn"><a name="dtor.EnginioModel"></a>EnginioModel::<span class="name">~EnginioModel</span>()</h3>
<p>Destroys the model.</p>
<!-- @@@~EnginioModel -->
<!-- $$$append[overload1]$$$appendconstQJsonObject& -->
<h3 class="fn"><a name="append"></a><span class="type"><a href="enginioreply.html">EnginioReply</a></span> * EnginioModel::<span class="name">append</span>(const <span class="type"><a href="../qtcore/qjsonobject.html">QJsonObject</a></span> &amp;<i> object</i>)</h3>
<p>Add a new <i>object</i> to the model and database.</p>
<p>This function appends the new object to the local model cache and makes an asynchronous request to the backend.</p>
<p>Since adding an object to the database may fail for various reasons, the returned reply must be kept and used for error handling (see <a href="enginioreply.html">EnginioReply</a>). If the operation fails, the object that was supposed to be appended will be removed from the local model again. If the model is used in a view and the backend does not accept the object because it violates a validator, it will be visible to the user that a new row in the view appears and disappears again.</p>
<p>Returns the <a href="enginioreply.html">EnginioReply</a> from the backend</p>
<p><b>See also </b><a href="enginioclient.html#create">EnginioClient::create</a>().</p>
<!-- @@@append -->
<!-- $$$remove[overload1]$$$removeint -->
<h3 class="fn"><a name="remove"></a><span class="type"><a href="enginioreply.html">EnginioReply</a></span> * EnginioModel::<span class="name">remove</span>(<span class="type">int</span><i> row</i>)</h3>
<p>Removes the <i>row</i> from the model and database.</p>
<p>This function immediately removes the <i>row</i> from the local cache and sends a remove request to the Enginio backend.</p>
<p>Returns the <a href="enginioreply.html">EnginioReply</a> from the backend.</p>
<p><b>See also </b><a href="enginioclient.html#remove">EnginioClient::remove</a>().</p>
<!-- @@@remove -->
<!-- $$$setData[overload1]$$$setDataintconstQVariant&constQString& -->
<h3 class="fn"><a name="setData"></a><span class="type"><a href="enginioreply.html">EnginioReply</a></span> * EnginioModel::<span class="name">setData</span>(<span class="type">int</span><i> row</i>, const <span class="type"><a href="../qtcore/qvariant.html">QVariant</a></span> &amp;<i> value</i>, const <span class="type"><a href="../qtcore/qstring.html">QString</a></span> &amp;<i> role</i>)</h3>
<p>Update a value on <i>row</i> of this model's local cache and send an update request to the Enginio backend.</p>
<p>The <i>role</i> is the property of the object that will be updated to be the new <i>value</i>.</p>
<p>Returns reply from backend.</p>
<p><b>See also </b><a href="enginioclient.html#update">EnginioClient::update</a>().</p>
<!-- @@@setData -->
</div>
        </div>
       </div>
   </div>
   </div>
</div>
<div class="footer">
   <p>
   <acronym title="Copyright">&copy;</acronym> 2014 Digia Plc and/or its
   subsidiaries. Documentation contributions included herein are the copyrights of
   their respective owners.<br>    The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.<br>    Digia, Qt and their respective logos are trademarks of Digia Plc     in Finland and/or other countries worldwide. All other trademarks are property
   of their respective owners. </p>
</div>
</body>
</html>
